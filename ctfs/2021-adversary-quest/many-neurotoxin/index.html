<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="ie=edge">
<meta itemprop=name content="Many Neurotoxin">
<meta itemprop=description content="Challenge Description:  Our investigation revealed that CATAPULT SPIDER uses artificial intelligence to classify images. We initially believed that they only encrypt cat pictures - but we now learned that they encrypt all images except Doge photographs. We recovered their classifier and model and believe it should be possible to subvert their classification method to protect images against encryption.
  We are providing a TAR file that contains their classification logic, model, and three pictures that must be protected at all cost."><meta itemprop=datePublished content="2021-02-06T19:51:06-06:00">
<meta itemprop=dateModified content="2021-02-06T19:51:06-06:00">
<meta itemprop=wordCount content="564">
<meta itemprop=keywords content="AdversaryQuest,CTFs,"><meta property="og:title" content="Many Neurotoxin">
<meta property="og:description" content="Challenge Description:  Our investigation revealed that CATAPULT SPIDER uses artificial intelligence to classify images. We initially believed that they only encrypt cat pictures - but we now learned that they encrypt all images except Doge photographs. We recovered their classifier and model and believe it should be possible to subvert their classification method to protect images against encryption.
  We are providing a TAR file that contains their classification logic, model, and three pictures that must be protected at all cost.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://joe.lothan.net/ctfs/2021-adversary-quest/many-neurotoxin/"><meta property="article:section" content="ctfs">
<meta property="article:published_time" content="2021-02-06T19:51:06-06:00">
<meta property="article:modified_time" content="2021-02-06T19:51:06-06:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Many Neurotoxin">
<meta name=twitter:description content="Challenge Description:  Our investigation revealed that CATAPULT SPIDER uses artificial intelligence to classify images. We initially believed that they only encrypt cat pictures - but we now learned that they encrypt all images except Doge photographs. We recovered their classifier and model and believe it should be possible to subvert their classification method to protect images against encryption.
  We are providing a TAR file that contains their classification logic, model, and three pictures that must be protected at all cost.">
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/site.webmanifest>
<link rel=mask-icon href=/safari-pinned-tab.svg color>
<link rel="shortcut icon" href=/favicon.ico>
<title>Many Neurotoxin</title>
<link rel=stylesheet href=https://joe.lothan.net/css/style.min.eac77496566fd7d5768fd650ddb0b2b181ca6a2d7c5fdd6fe6b8ba4bf47e566f.css integrity="sha256-6sd0llZv19V2j9ZQ3bCysYHKai18X91v5ri6S/R+Vm8=" crossorigin=anonymous>
<link rel=stylesheet href=https://joe.lothan.net/css/custom.css>
</head>
<body id=page>
<header id=site-header class="animated slideInUp">
<div class="hdr-wrapper section-inner">
<div class=hdr-left>
<div class=site-branding>
<a href=https://joe.lothan.net/>Joe Lothan</a>
</div>
<nav class="site-nav hide-in-mobile">
<a href=https://joe.lothan.net/ctfs/>CTFs</a>
</nav>
</div>
<div class="hdr-right hdr-icons">
<span class="hdr-social hide-in-mobile"><a href=https://github.com/lothan target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://twitter.com/ertplusy76p target=_blank rel="noopener me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button>
</div>
</div>
</header>
<div id=mobile-menu class="animated fast">
<ul>
<li><a href=https://joe.lothan.net/ctfs/>CTFs</a></li>
</ul>
</div>
<main class="site-main section-inner thin animated fadeIn faster">
<h1>Many Neurotoxin</h1>
<div class=content>
<h4 id=challenge-description>Challenge Description:<a href=#challenge-description class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4>
<blockquote>
<p>Our investigation revealed that CATAPULT SPIDER uses artificial intelligence to classify images. We initially believed that they only encrypt cat pictures - but we now learned that they encrypt all images <em>except</em> Doge photographs. We recovered their classifier and model and believe it should be possible to subvert their classification method to protect images against encryption.</p>
</blockquote>
<blockquote>
<p>We are providing a TAR file that contains their classification logic, model, and three pictures that must be protected at all cost. We also stood up a service that integrates CATAPULT SPIDER&rsquo;s classification logic at <code>neurotoxin.challenges.adversary.zone:40755</code></p>
</blockquote>
<blockquote>
<p>If you&rsquo;re confident that you can protect the images by getting CATAPULT SPIDER to misclassify them, please submit them to our service to receive your reward.</p>
</blockquote>
<h4 id=write-up>Write-Up:<a href=#write-up class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h4>
<p>For this challenge we need to beat a given neural network. Specifically generate some <a href=https://en.wikipedia.org/wiki/Adversarial_machine_learning>adversarial images</a> from given images that look like the original but cause the neural network to misclassify them. I know very little about machine learning and <a href=https://medium.com/@ageitgey/machine-learning-is-fun-part-8-how-to-intentionally-trick-neural-networks-b55da32b7196>this post</a> was helpful for the basics of this challenge.</p>
<p>Adversarial images are often generated to better train the neural network itself, so I thought there must be some software already out there that makes this easy. Enter: <a href=https://github.com/bethgelab/foolbox>foolbox</a>, &ldquo;a Python library that lets you easily run adversarial attacks against machine learning models like deep neural networks.&rdquo;</p>
<p>Foolbox has a good tutorial in the form of a <a href=https://github.com/jonasrauber/foolbox-native-tutorial/blob/master/foolbox-native-tutorial.ipynb>Jupyter notebook</a> so I decided to make my own to play around. <a href=attac.ipynb>Here</a> is my final notebook. To run this you need to install <code>jupyter-notebook</code>, <code>tensorflow</code>, and <code>foolbox</code>. When installing <code>foolbox</code>, it&rsquo;s best to install the latest version from github using <code>pip</code>:</p>
<pre tabindex=0><code>$ pip install git+https://github.com/bethgelab/foolbox
</code></pre><p>After loading the cat pictures into an acceptable tensor using the given code, we can create a batch tensor to use with our model.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Python data-lang=Python>cats <span style=color:#f92672>=</span> [load_and_deserialize_picture(<span style=color:#e6db74>&#34;pics/cat1&#34;</span>),
        load_and_deserialize_picture(<span style=color:#e6db74>&#34;pics/cat2&#34;</span>),
        load_and_deserialize_picture(<span style=color:#e6db74>&#34;pics/cat3&#34;</span>)]

catz <span style=color:#f92672>=</span> tf<span style=color:#f92672>.</span>convert_to_tensor(cats)
</code></pre></div><p>Then we can load our model and load it into a foolbox model. We also create a <code>TargetedMisclassification</code> object to tell foolbox we want our images to be misclassified as doges (category #3).</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Python data-lang=Python>model <span style=color:#f92672>=</span> tf<span style=color:#f92672>.</span>keras<span style=color:#f92672>.</span>models<span style=color:#f92672>.</span>load_model(<span style=color:#e6db74>&#34;./tf-model&#34;</span>)
fmodel <span style=color:#f92672>=</span> fb<span style=color:#f92672>.</span>TensorFlowModel(model, bounds<span style=color:#f92672>=</span>(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>1</span>))

dogs <span style=color:#f92672>=</span> tf<span style=color:#f92672>.</span>convert_to_tensor([<span style=color:#ae81ff>3</span>,<span style=color:#ae81ff>3</span>,<span style=color:#ae81ff>3</span>])
dogez <span style=color:#f92672>=</span> fb<span style=color:#f92672>.</span>criteria<span style=color:#f92672>.</span>TargetedMisclassification(dogs)
</code></pre></div><p>All that&rsquo;s left to do is actually run the attack.</p>
<p>Foolbox makes it this easy to generate adversarial images. The output tensors are saved in <code>clipped</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Python data-lang=Python>attack <span style=color:#f92672>=</span> fb<span style=color:#f92672>.</span>attacks<span style=color:#f92672>.</span>LinfProjectedGradientDescentAttack()
raw, clipped, is_adv <span style=color:#f92672>=</span> attack(fmodel, catz, dogez, epsilons<span style=color:#f92672>=</span><span style=color:#ae81ff>.02</span>)
</code></pre></div><p>Foolbox has a whole toolkit of attacks. The tutorial gives the example of a <code>L2CarliniWagnerAttack</code> for a targeted misclassification attack but it didn&rsquo;t end up working for me. I tried every other attack but it either didn&rsquo;t produce a misclassified cat or it wasn&rsquo;t possible to run a targeted attack. Then I searched their github for &ldquo;TargetedMisclassification&rdquo; and it turns out their more recent code allows for more attacks to be run as targeted. Using their code from github and running the <code>LinfProjectedGradientDescentAttack</code> ended up working.</p>
<pre tabindex=0><code>$ python example-evaluation.py out/cat1 --original my-cat-pictures/cat1.png 
[+] both images are close enough
[*] prediction result (classified as Doge):
    class #0 =&gt; 0.12% (Cat)
    class #1 =&gt; 0.01% (Cow)
    class #2 =&gt; 0.00% (Elephant)
    class #3 =&gt; 99.82% (Doge)
    class #4 =&gt; 0.05% (Squirrel)
[+] picture won't be encrypted \o/
</code></pre><p>For a visual, here is the original image and the adversarial image:</p>
<p><img src=images/neurotoxin-og-cat.png alt="original cat image"> <img src=images/neurotoxin-cat-doge.png alt="adversarially generated image"></p>
<p>Upon submitting the three cat pictures to their service, you recieve the flag in the same format as sent: a base64 serialized tensor. Converting it to an image:</p>
<p><img src=./images/neurotoxin-flag.png alt="converting the recieved tensor to an image to get the flag"></p>
</div>
</main>
<footer id=site-footer class="section-inner thin animated fadeIn faster">
<p>&copy; 2022 <a href=https://joe.lothan.net/>Joe Lothan</a></p>
<p>
Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://joe.lothan.net/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a>
</p>
</footer>
<script src=https://joe.lothan.net/js/bundle.min.7d8545daa55d62427355498dd8da13f98ff79a7938ce7d2a5e2ae1ec0de3beb8.js integrity="sha256-fYVF2qVdYkJzVUmN2NoT+Y/3mnk4zn0qXirh7A3jvrg=" crossorigin=anonymous></script>
</body>
</html>