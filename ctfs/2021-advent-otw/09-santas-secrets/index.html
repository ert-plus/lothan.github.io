<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="ie=edge">
<meta itemprop=name content="Day 9 - Santas Secrets">
<meta itemprop=description content="Challenge Description Santa built a service to allow elves to encrypt secret data without having access to the keys.
(Download Files)
Overview We&rsquo;re given a python webserver with an encrypted flag and the key that was used to encrypt it, but we can only read the encrypted flag and use the key to encrypt data, not read the key itself. Using a bug in python data encoding, we can overwrite successive bytes of the key, use it to encrypt known data, and brute force the entire key, using it to decrypt the flag."><meta itemprop=datePublished content="2021-12-19T17:35:43-06:00">
<meta itemprop=dateModified content="2021-12-19T17:35:43-06:00">
<meta itemprop=wordCount content="1140">
<meta itemprop=keywords content><meta property="og:title" content="Day 9 - Santas Secrets">
<meta property="og:description" content="Challenge Description Santa built a service to allow elves to encrypt secret data without having access to the keys.
(Download Files)
Overview We&rsquo;re given a python webserver with an encrypted flag and the key that was used to encrypt it, but we can only read the encrypted flag and use the key to encrypt data, not read the key itself. Using a bug in python data encoding, we can overwrite successive bytes of the key, use it to encrypt known data, and brute force the entire key, using it to decrypt the flag.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://joe.lothan.net/ctfs/2021-advent-otw/09-santas-secrets/"><meta property="article:section" content="ctfs">
<meta property="article:published_time" content="2021-12-19T17:35:43-06:00">
<meta property="article:modified_time" content="2021-12-19T17:35:43-06:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Day 9 - Santas Secrets">
<meta name=twitter:description content="Challenge Description Santa built a service to allow elves to encrypt secret data without having access to the keys.
(Download Files)
Overview We&rsquo;re given a python webserver with an encrypted flag and the key that was used to encrypt it, but we can only read the encrypted flag and use the key to encrypt data, not read the key itself. Using a bug in python data encoding, we can overwrite successive bytes of the key, use it to encrypt known data, and brute force the entire key, using it to decrypt the flag.">
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/site.webmanifest>
<link rel=mask-icon href=/safari-pinned-tab.svg color>
<link rel="shortcut icon" href=/favicon.ico>
<title>Day 9 - Santas Secrets</title><link rel=stylesheet href=https://joe.lothan.net/css/style.min.eac77496566fd7d5768fd650ddb0b2b181ca6a2d7c5fdd6fe6b8ba4bf47e566f.css integrity="sha256-6sd0llZv19V2j9ZQ3bCysYHKai18X91v5ri6S/R+Vm8=" crossorigin=anonymous>
<link rel=stylesheet href=https://joe.lothan.net/css/custom.css>
</head><body id=page>
<header id=site-header class="animated slideInUp">
<div class="hdr-wrapper section-inner">
<div class=hdr-left>
<div class=site-branding>
<a href=https://joe.lothan.net/>Joe Lothan</a>
</div><nav class="site-nav hide-in-mobile">
<a href=https://joe.lothan.net/ctfs/>CTFs</a>
</nav></div><div class="hdr-right hdr-icons">
<span class="hdr-social hide-in-mobile"><a href=https://github.com/ert-plus target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://twitter.com/ert_plus target=_blank rel="noopener me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button>
</div></div></header><div id=mobile-menu class="animated fast">
<ul>
<li><a href=https://joe.lothan.net/ctfs/>CTFs</a></li></ul></div><main class="site-main section-inner thin animated fadeIn faster">
<h1>Day 9 - Santas Secrets</h1><div class=content>
<h2 id=challenge-description>Challenge Description<a href=#challenge-description class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>Santa built a service to allow elves to encrypt secret data without having access to the keys.</p><p><a href=files/server.py>(Download Files)</a></p><h2 id=overview>Overview<a href=#overview class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>We&rsquo;re given a python webserver with an encrypted flag and the key that was used to encrypt it, but we can only read the encrypted flag and use the key to encrypt data, not read the key itself. Using a bug in python data encoding, we can overwrite successive bytes of the key, use it to encrypt known data, and brute force the entire key, using it to decrypt the flag.</p><h2 id=writeup>Writeup<a href=#writeup class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>The encryption server allows for a few commands, <code>write_data</code>, <code>read_data</code>, <code>write_key</code>, and <code>encrypt</code>. All operate on indexed 16-byte keyslots and dataslots, so here are a few example commands:</p><ul>
<li>To write ascii data to dataslot 1</li></ul><p><code>write_data 1 16_bytes_of_data ascii</code></p><ul>
<li>To read from dataslot <code>1</code>:</li></ul><p><code>read_data 1</code></p><ul>
<li>To write a secret key in hex to keyslot 4 (different from dataslot 4)</li></ul><p><code>write_key 4 7365637265745f6b65795f636f646521 hex</code></p><ul>
<li>To encrypt using keyslot 4, the data in dataslot 1 and saving it in dataslot 0</li></ul><p><code>encrypt 4 1 0</code></p><p>The initial state of the machine is set up using these commands. There&rsquo;s a random 16 byte key in keyslot 5 and our flag is encrypted using that key in dataslots 0 and 1.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>        se<span style=color:#f92672>.</span>run_cmd(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;write_key 5 </span><span style=color:#e6db74>{</span>os<span style=color:#f92672>.</span>urandom(SLOT_SIZE)<span style=color:#f92672>.</span>hex()<span style=color:#e6db74>}</span><span style=color:#e6db74> hex&#34;</span>)
</span></span><span style=display:flex><span>        se<span style=color:#f92672>.</span>run_cmd(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;write_data 0 </span><span style=color:#e6db74>{</span>FLAG[:<span style=color:#ae81ff>16</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74> ascii&#34;</span>)
</span></span><span style=display:flex><span>        se<span style=color:#f92672>.</span>run_cmd(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;write_data 1 </span><span style=color:#e6db74>{</span>FLAG[<span style=color:#ae81ff>16</span>:]<span style=color:#e6db74>}</span><span style=color:#e6db74> ascii&#34;</span>)
</span></span><span style=display:flex><span>        se<span style=color:#f92672>.</span>run_cmd(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;encrypt 5 0 0&#34;</span>)
</span></span><span style=display:flex><span>        se<span style=color:#f92672>.</span>run_cmd(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;encrypt 5 1 1&#34;</span>)
</span></span></code></pre></div><p>Looking at how the server handles these commands and the first thing that stands out is that all the keyslots and dataslots are two big byte arrays, rather than, say, a list of bytes.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>NUM_SLOTS <span style=color:#f92672>=</span> <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span>SLOT_SIZE <span style=color:#f92672>=</span> <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecurityEngine</span>():
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> __init__(self):
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>keyslots  <span style=color:#f92672>=</span> bytearray(SLOT_SIZE <span style=color:#f92672>*</span> NUM_SLOTS)
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>dataslots <span style=color:#f92672>=</span> bytearray(SLOT_SIZE <span style=color:#f92672>*</span> NUM_SLOTS)
</span></span></code></pre></div><p>The next strangeness is that you can write keys using hex or ascii, but the server doesn&rsquo;t use <code>data.encode("ASCII")</code>, just <code>data.encode()</code>. Python uses UTF-8 by default for <code>.encode()</code> so it is possible to write a key that is longer than 16 bytes by using unicode characters. We can use this bug to brute force the key in keyslot 5 and get our flag.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>        <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>cmd_write_key</span>(self, slot_idx, data, encoding):
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;&#34;&#34;write data to a chosen keyslot&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span>: slot_idx <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_parse_slot_idx(slot_idx)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>except</span>: <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;ERROR: Invalid index&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span>: data <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_parse_data_string(data, encoding)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>except</span>: <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;ERROR: Invalid data length or encoding&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>keyslots[SLOT_SIZE<span style=color:#f92672>*</span>slot_idx:SLOT_SIZE<span style=color:#f92672>*</span>slot_idx<span style=color:#f92672>+</span>len(data)] <span style=color:#f92672>=</span> data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;keyslot[</span><span style=color:#e6db74>{</span>slot_idx<span style=color:#e6db74>}</span><span style=color:#e6db74>] &lt;= </span><span style=color:#e6db74>{</span>data<span style=color:#f92672>.</span>hex()<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_parse_data_string</span>(self, data, encoding):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> encoding <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;hex&#34;</span>:
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> len(data) <span style=color:#f92672>!=</span> SLOT_SIZE <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>:
</span></span><span style=display:flex><span>                                <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>Exception</span>(<span style=color:#e6db74>&#34;Invalid data length&#34;</span>)
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>return</span> bytes<span style=color:#f92672>.</span>fromhex(data)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>elif</span> encoding <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;ascii&#34;</span>:
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> len(data) <span style=color:#f92672>!=</span> SLOT_SIZE:
</span></span><span style=display:flex><span>                                <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>Exception</span>(<span style=color:#e6db74>&#34;Invalid data length&#34;</span>)
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>return</span> data<span style=color:#f92672>.</span>encode()
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>Exception</span>(<span style=color:#e6db74>&#34;Invalid encoding&#34;</span>)
</span></span></code></pre></div><p>To brute force, we overwrite all but one byte of the key and encrypt a known plaintext with it. Then we can brute force the last byte by trying all 256 possible bytes and see which produces the same ciphertext. Knowing the last byte, we can brute force the second to last byte, on and on.</p><p>Obviously we can&rsquo;t un-overwrite the key, so we first send our commands, overwriting one byte of the key at a time, then brute force the key from the output.</p><pre tabindex=0><code>&gt; cat msg
read_data 0
read_data 1
encrypt 5 2 3
read_data 2
write_key 4 ϏAAAAAAAAAAAAAAA ascii
encrypt 5 2 3
read_data 2
write_key 4 ϏϏAAAAAAAAAAAAAA ascii
encrypt 5 2 3
read_data 2
write_key 4 ϏϏϏAAAAAAAAAAAAA ascii
encrypt 5 2 3
read_data 2
write_key 4 ϏϏϏϏAAAAAAAAAAAA ascii
encrypt 5 2 3
read_data 2
write_key 4 ϏϏϏϏϏAAAAAAAAAAA ascii
encrypt 5 2 3
read_data 2
write_key 4 ϏϏϏϏϏϏAAAAAAAAAA ascii
encrypt 5 2 3
read_data 2
write_key 4 ϏϏϏϏϏϏϏAAAAAAAAA ascii
encrypt 5 2 3
read_data 2
write_key 4 ϏϏϏϏϏϏϏϏAAAAAAAA ascii
encrypt 5 2 3
read_data 2
write_key 4 ϏϏϏϏϏϏϏϏϏAAAAAAA ascii
encrypt 5 2 3
read_data 2
write_key 4 ϏϏϏϏϏϏϏϏϏϏAAAAAA ascii
encrypt 5 2 3
read_data 2
write_key 4 ϏϏϏϏϏϏϏϏϏϏϏAAAAA ascii
encrypt 5 2 3
read_data 2
write_key 4 ϏϏϏϏϏϏϏϏϏϏϏϏAAAA ascii
encrypt 5 2 3
read_data 2
write_key 4 ϏϏϏϏϏϏϏϏϏϏϏϏϏAAA ascii
encrypt 5 2 3
read_data 2
write_key 4 ϏϏϏϏϏϏϏϏϏϏϏϏϏϏAA ascii
encrypt 5 2 3
read_data 2
write_key 4 ϏϏϏϏϏϏϏϏϏϏϏϏϏϏϏA ascii
encrypt 5 2 3
read_data 2
&gt; nc santas-secrets.advent2021.overthewire.org 1209 &lt; msg &gt; output.txt
&gt; head output.txt
5e9c669210723542bf58239a03df5572
57e96709a95ddb8e520158efcb2eddc5
dataslot[2] &lt;= AES(key=keyslot[5], data=dataslot[3])
f93dab5aeeb7314e21995b8ea81c17af
keyslot[4] &lt;= cf8f414141414141414141414141414141
dataslot[2] &lt;= AES(key=keyslot[5], data=dataslot[3])
29b2f8c5a47cd028aefbe7fac8f6c03f
keyslot[4] &lt;= cf8fcf8f4141414141414141414141414141
dataslot[2] &lt;= AES(key=keyslot[5], data=dataslot[3])
b91e052ad1f88222b3ec9d8aab39e5c1
</code></pre><p>Using the following script to brute force the key:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Cryptodome.Cipher <span style=color:#f92672>import</span> AES  <span style=color:#75715e># pip3 install pycryptodomex</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#34;output.txt&#34;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>    lines <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>readlines()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flag1 <span style=color:#f92672>=</span> bytes<span style=color:#f92672>.</span>fromhex(lines<span style=color:#f92672>.</span>pop(<span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>strip())
</span></span><span style=display:flex><span>flag2 <span style=color:#f92672>=</span> bytes<span style=color:#f92672>.</span>fromhex(lines<span style=color:#f92672>.</span>pop(<span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>strip())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ciphertexts <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>keyparts <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;&#39;</span>]
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i, l <span style=color:#f92672>in</span> enumerate(lines):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> i <span style=color:#f92672>%</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> i <span style=color:#f92672>%</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>        ciphertexts<span style=color:#f92672>.</span>insert(<span style=color:#ae81ff>0</span>, l<span style=color:#f92672>.</span>strip())
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> i <span style=color:#f92672>%</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>:
</span></span><span style=display:flex><span>        keyparts<span style=color:#f92672>.</span>insert(<span style=color:#ae81ff>0</span>,l<span style=color:#f92672>.</span> strip()<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34; &lt;= &#34;</span>)[<span style=color:#ae81ff>1</span>][<span style=color:#ae81ff>32</span>:]) <span style=color:#75715e># sorry it&#39;s ugly</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;ciphertexts:&#34;</span>, len(ciphertexts))
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> ct <span style=color:#f92672>in</span> ciphertexts:
</span></span><span style=display:flex><span>    print(ct)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;keyparts&#34;</span>, len(keyparts))
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> kp <span style=color:#f92672>in</span> keyparts:
</span></span><span style=display:flex><span>    print(kp)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>key <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>plaintext <span style=color:#f92672>=</span> bytes<span style=color:#f92672>.</span>fromhex(<span style=color:#e6db74>&#39;00000000000000000000000000000000&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> len(key) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>16</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;testing against ct:&#34;</span>, ciphertexts[i])
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;with keypart&#34;</span>, keyparts[i])
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> b <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>256</span>):
</span></span><span style=display:flex><span>        test_key <span style=color:#f92672>=</span> bytes<span style=color:#f92672>.</span>fromhex(keyparts[i]) <span style=color:#f92672>+</span> bytes([b]) <span style=color:#f92672>+</span> key
</span></span><span style=display:flex><span>        <span style=color:#75715e># print(&#34;keypart:&#34;, test_key.hex())</span>
</span></span><span style=display:flex><span>        ciphertext <span style=color:#f92672>=</span> AES<span style=color:#f92672>.</span>new(key<span style=color:#f92672>=</span>test_key, mode<span style=color:#f92672>=</span>AES<span style=color:#f92672>.</span>MODE_ECB)<span style=color:#f92672>.</span>encrypt(plaintext)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ciphertext <span style=color:#f92672>==</span> bytes<span style=color:#f92672>.</span>fromhex(ciphertexts[i]):
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;found byte of key: &#34;</span>, bytes([b])<span style=color:#f92672>.</span>hex())
</span></span><span style=display:flex><span>            <span style=color:#75715e># print(&#34;with ciphertext:&#34;, ciphertext.hex())</span>
</span></span><span style=display:flex><span>            i <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            key <span style=color:#f92672>=</span> bytes([b]) <span style=color:#f92672>+</span> key
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;current key:&#34;</span>, key<span style=color:#f92672>.</span>hex())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;flag: &#34;</span>)
</span></span><span style=display:flex><span>print(AES<span style=color:#f92672>.</span>new(key<span style=color:#f92672>=</span>key, mode<span style=color:#f92672>=</span>AES<span style=color:#f92672>.</span>MODE_ECB)<span style=color:#f92672>.</span>decrypt(flag1)<span style=color:#f92672>.</span>decode(), end<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>print(AES<span style=color:#f92672>.</span>new(key<span style=color:#f92672>=</span>key, mode<span style=color:#f92672>=</span>AES<span style=color:#f92672>.</span>MODE_ECB)<span style=color:#f92672>.</span>decrypt(flag2)<span style=color:#f92672>.</span>decode(), end<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>)
</span></span></code></pre></div><pre tabindex=0><code>&gt; python3 brute-key.py
ciphertexts: 16
3bf33bfad227f6c0c2f47df77a449561
faa78fb2cc9e8e35115cc4fa21cf39f1
12b398d692afdf8d0e4465f53c8a95ec
f5fca8bcb1b07430a89982db45c7e18d
5bed5eb82a3d5023bbfaaeff3d8e0caf
5566b05dd140266afb814ef1f74ae4cf
c5778daf79147119b4c040dac34973fa
e9ef830fae37bca4d328664cae648c39
c0560043fa597e22861b577d19af555c
cb629a7a857f7bf3ba974db50b87b662
ded2b0769b207fc3f0ee2f38932c9218
4ba0e0968a152cff03f12ebbc6f06af4
2f09b0fc1f54ca4064e16a98e97acc1a
b91e052ad1f88222b3ec9d8aab39e5c1
29b2f8c5a47cd028aefbe7fac8f6c03f
f93dab5aeeb7314e21995b8ea81c17af
keyparts 16
cf8fcf8fcf8fcf8fcf8fcf8fcf8f41
cf8fcf8fcf8fcf8fcf8fcf8f4141
cf8fcf8fcf8fcf8fcf8f414141
cf8fcf8fcf8fcf8f41414141
cf8fcf8fcf8f4141414141
cf8fcf8f414141414141
cf8f41414141414141
4141414141414141
41414141414141
414141414141
4141414141
41414141
414141
4141
41

testing against ct: 3bf33bfad227f6c0c2f47df77a449561
with keypart cf8fcf8fcf8fcf8fcf8fcf8fcf8f41
found byte of key:  13
current key: 13
testing against ct: faa78fb2cc9e8e35115cc4fa21cf39f1
with keypart cf8fcf8fcf8fcf8fcf8fcf8f4141
found byte of key:  da
current key: da13
testing against ct: 12b398d692afdf8d0e4465f53c8a95ec
with keypart cf8fcf8fcf8fcf8fcf8f414141
found byte of key:  9d
current key: 9dda13
testing against ct: f5fca8bcb1b07430a89982db45c7e18d
with keypart cf8fcf8fcf8fcf8f41414141
found byte of key:  9a
current key: 9a9dda13
testing against ct: 5bed5eb82a3d5023bbfaaeff3d8e0caf
with keypart cf8fcf8fcf8f4141414141
found byte of key:  07
current key: 079a9dda13
testing against ct: 5566b05dd140266afb814ef1f74ae4cf
with keypart cf8fcf8f414141414141
found byte of key:  d4
current key: d4079a9dda13
testing against ct: c5778daf79147119b4c040dac34973fa
with keypart cf8f41414141414141
found byte of key:  a7
current key: a7d4079a9dda13
testing against ct: e9ef830fae37bca4d328664cae648c39
with keypart 4141414141414141
found byte of key:  30
current key: 30a7d4079a9dda13
testing against ct: c0560043fa597e22861b577d19af555c
with keypart 41414141414141
found byte of key:  15
current key: 1530a7d4079a9dda13
testing against ct: cb629a7a857f7bf3ba974db50b87b662
with keypart 414141414141
found byte of key:  93
current key: 931530a7d4079a9dda13
testing against ct: ded2b0769b207fc3f0ee2f38932c9218
with keypart 4141414141
found byte of key:  01
current key: 01931530a7d4079a9dda13
testing against ct: 4ba0e0968a152cff03f12ebbc6f06af4
with keypart 41414141
found byte of key:  54
current key: 5401931530a7d4079a9dda13
testing against ct: 2f09b0fc1f54ca4064e16a98e97acc1a
with keypart 414141
found byte of key:  e4
current key: e45401931530a7d4079a9dda13
testing against ct: b91e052ad1f88222b3ec9d8aab39e5c1
with keypart 4141
found byte of key:  62
current key: 62e45401931530a7d4079a9dda13
testing against ct: 29b2f8c5a47cd028aefbe7fac8f6c03f
with keypart 41
found byte of key:  9f
current key: 9f62e45401931530a7d4079a9dda13
testing against ct: f93dab5aeeb7314e21995b8ea81c17af
with keypart 
found byte of key:  d9
current key: d99f62e45401931530a7d4079a9dda13
flag: 
AOTW{n0oO_d0nt_0v3rfl0w_my_bufs}
</code></pre></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster">
<p>&copy; 2022 <a href=https://joe.lothan.net/>Joe Lothan</a></p><p>
Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://joe.lothan.net/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a>
</p></footer><script src=https://joe.lothan.net/js/bundle.min.8256b8724b9578bbdf6d6f04c894255bc760e78e8a2d60ec0a91ea993acd3b77.js integrity="sha256-gla4ckuVeLvfbW8EyJQlW8dg546KLWDsCpHqmTrNO3c=" crossorigin=anonymous></script>
</body></html>